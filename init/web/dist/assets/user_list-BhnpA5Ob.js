import{_ as I}from"./gvb_table.vue_vue_type_style_index_0_lang-DLBiV87R.js";import{N as L,d as N,m as A,a as _,o as q,b as C,e,w as r,p as y,$ as R,M as b,r as i,g as E,z as x,a0 as F,a1 as M}from"./index-C_OMfqPK.js";function T(c){return L.get("/api/role_ids",{params:c})}const O=[{label:"普通用户",value:2},{label:"超级管理员",value:1},{label:"游客",value:3}],j=N({__name:"user_create",props:{visible:{type:Boolean}},emits:["update:visible","ok"],setup(c,{emit:g}){const V=c,d=g,f={nick_name:"",password:"",role:2,user_name:"",re_password:""},t=A({nick_name:"",password:"",role:2,user_name:"",re_password:""}),m=_();function n(p,l){if(p!==t.password)return l("确认密码不一致")}async function k(){if(await m.value.validate())return!1;let l=await R(t);if(l.code){b.error(l.msg);return}return b.success(l.msg),d("update:visible",!1),d("ok"),Object.assign(t,f),!0}return(p,l)=>{const u=i("a-input"),a=i("a-form-item"),w=i("a-select"),v=i("a-form"),U=i("a-modal");return q(),C("div",null,[e(U,{title:"创建用户",visible:V.visible,"on-before-ok":k,onCancel:l[5]||(l[5]=s=>d("update:visible",!1))},{default:r(()=>[e(v,{ref_key:"formRef",ref:m,model:t},{default:r(()=>[e(a,{field:"user_name",label:"用户名",rules:[{required:!0,message:"请输入用户名"}],"validate-trigger":["blur"]},{default:r(()=>[e(u,{modelValue:t.user_name,"onUpdate:modelValue":l[0]||(l[0]=s=>t.user_name=s),placeholder:"用户名"},null,8,["modelValue"])]),_:1}),e(a,{field:"nick_name",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],"validate-trigger":["blur"]},{default:r(()=>[e(u,{modelValue:t.nick_name,"onUpdate:modelValue":l[1]||(l[1]=s=>t.nick_name=s),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),e(a,{field:"password",label:"密码",rules:[{required:!0,message:"请输入密码"}],"validate-trigger":["blur"]},{default:r(()=>[e(u,{type:"password",modelValue:t.password,"onUpdate:modelValue":l[2]||(l[2]=s=>t.password=s),placeholder:"密码"},null,8,["modelValue"])]),_:1}),e(a,{field:"re_password",label:"确认密码",rules:[{required:!0,message:"请输入确认密码"},{validator:n}],"validate-trigger":["blur"]},{default:r(()=>[e(u,{type:"password",modelValue:t.re_password,"onUpdate:modelValue":l[3]||(l[3]=s=>t.re_password=s),placeholder:"确认密码"},null,8,["modelValue"])]),_:1},8,["rules"]),e(a,{field:"role",label:"权限"},{default:r(()=>[e(w,{modelValue:t.role,"onUpdate:modelValue":l[4]||(l[4]=s=>t.role=s),options:y(O),placeholder:"选择角色"},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),G=N({__name:"user_list",setup(c){const g=[{title:"昵称",dataIndex:"nick_name"},{title:"头像",slotName:"avatar"},{title:"邮箱",dataIndex:"email"},{title:"角色",dataIndex:"role"},{title:"ip/地址",slotName:"ip"},{title:"注册时间",slotName:"created_at"},{title:"操作",slotName:"action"}],V=[{label:"角色过滤",column:"role",source:T}],d=_(!1),f=_();function t(){f.value.getList()}const m=_(!1),n=A({nick_name:"",role:0,user_id:0});function k(u){n.user_id=u.id,n.role=u.role_id,n.nick_name=u.nick_name,m.value=!0}const p=_();async function l(){if(await p.value.validate())return!1;let a=await F(n);if(a.code){b.error(a.msg);return}return b.success(a.msg),f.value.getList(),!0}return(u,a)=>{const w=i("a-input"),v=i("a-form-item"),U=i("a-select"),s=i("a-form"),$=i("a-modal"),B=i("a-avatar");return q(),C("div",null,[e(j,{visible:d.value,"onUpdate:visible":a[0]||(a[0]=o=>d.value=o),onOk:t},null,8,["visible"]),e($,{title:"编辑用户",visible:m.value,"onUpdate:visible":a[3]||(a[3]=o=>m.value=o),"on-before-ok":l},{default:r(()=>[e(s,{ref_key:"formRef",ref:p,model:n},{default:r(()=>[e(v,{field:"nick_name",label:"昵称",rules:[{required:!0,message:"请输入昵称"}],"validate-trigger":["blur"]},{default:r(()=>[e(w,{modelValue:n.nick_name,"onUpdate:modelValue":a[1]||(a[1]=o=>n.nick_name=o),placeholder:"昵称"},null,8,["modelValue"])]),_:1}),e(v,{field:"role",label:"权限"},{default:r(()=>[e(U,{modelValue:n.role,"onUpdate:modelValue":a[2]||(a[2]=o=>n.role=o),options:y(O),placeholder:"选择角色"},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),e(I,{url:y(M),columns:g,"default-delete":"","add-label":"创建用户","no-confirm":"",ref_key:"gvbTable",ref:f,"filter-group":V,"search-placeholder":"搜索用户名、昵称",onAdd:a[4]||(a[4]=o=>d.value=!0),onEdit:k},{avatar:r(({record:o})=>[e(B,{imageUrl:o.avatar},null,8,["imageUrl"])]),ip:r(({record:o})=>[E("span",null,x(o.ip)+" ("+x(o.addr)+")",1)]),_:1},8,["url"])])}}});export{G as default};
